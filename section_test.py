import pefile
import os

# pe = pefile.PE(
#     '/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Virus_samples/VirusShare_4a6b41c239dd943b77b74737c670e610')

# pe = pefile.PE('/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Adware_samples/VirusShare_4b9b61fefc3d8732974429fff2ac1920')
rootdir = "/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Adware_samples/"

# for section in pe.sections:
#     print(section.Name)

dSections = ['.data', '.rsrc', '.reloc,', '.rdata']

section_names = []

for subdir, dirs, files in os.walk(rootdir):
    for file in files:
        input_file = rootdir + '/' + file
        section_names.append(file)
        try:
            pe = pefile.PE(input_file)
        except Exception as e:
            print("Exception while loading file: ", e)
        else:
            for section in pe.sections:
                sectionname = ''.join(filter(lambda c: c != '\0', str(section.Name.decode('utf-8'))))

                if sectionname in dSections:
                    section_names.append(sectionname)

print(section_names)
