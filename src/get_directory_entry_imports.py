import pefile

alerts = ["LoadLibrary",
        "GetProcAddress",
        "MessageBox",
        "ShellExecute",
        "IsDebuggerPresent",
        "VirtualAlloc",
        "CreateThread",
        "CreateProcess",
        "OpenProcess*",
        "RaiseException",
        "CreateEvent",
        "GetSystemInfo",
        "GetComputerName",
        "SetWindowsHook",
        "WriteProcessMemory",
        "GetTickCount",
        "Sleep",
        "GetDiskFreeSpace",
        "SetThreadContext",
        "CreateRemoteThread",
        "GetVersion",
        "GetProcessHeap",
        "GetUserName",
        "ExitProcess",
        "CorExeMain",
        "WaitForSingleObject",
        "GetStartupInfo",
        "GetKeyboard",
        "SetUnhandledExceptionFilter",
        "HttpSendRequest",
        "HttpQueryInfo"
                        ]

# pe = pefile.PE('/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Adware_samples/VirusShare_4b9b61fefc3d8732974429fff2ac1920')
#pe = pefile.PE('/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Virus_samples/VirusShare_4a6b41c239dd943b77b74737c670e610')
pe = pefile.PE('/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Benign/SpotifySetup.exe')


def check_imports(pe):
    ret = []
    ret2 = []
    if not hasattr(pe, 'DIRECTORY_ENTRY_IMPORT'):
        return ret
    for lib in pe.DIRECTORY_ENTRY_IMPORT:
        for imp in lib.imports:
            ret.append(imp.name)
    for n in ret:
        if n:
            n = n.decode('utf-8')
            if any(map(n.startswith, alerts)):
                for a in alerts:
                    if n.startswith(a):
                        # ret2.append("{}^{}".format(n, alerts.get(a)))
                        ret2.append(n)

    # print(ret)
    print(ret2)


check_imports(pe)