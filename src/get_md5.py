import hashlib
import os
import csv


# MD5 calculation function

def md5sum(filename):
    md5 = hashlib.md5()
    with open(filename, 'rb') as f:
        for chunk in iter(lambda: f.read(128 * md5.block_size), b''):
            md5.update(chunk)
    return md5.hexdigest()



rootdir = "/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Virus_samples/"
output = "/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Virus_samples_header_features.csv"

count = 1
csv_file = open(output, mode="w")

writer = csv.writer(csv_file, delimiter=',')
writer.writerow(["fileName", "MD5hash"])

for subdir, dirs, files in os.walk(rootdir):
    for file in files:
        try:
            fileHash = md5sum(rootdir + '/' + file)
        except Exception as e:
            print("Error while calculating MD5 for the file", file)
        else:
            print("Writing file number", count)
            writer.writerow([file, fileHash])
            count += 1
    csv_file.close()
