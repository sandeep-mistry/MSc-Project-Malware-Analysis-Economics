import pefile

# pe = pefile.PE('/media/sandeep/DATA/raw_final_dataset/RAW_final_dataset/Benign/SpotifySetup.exe')
pe = pefile.PE('/media/sandeep/DATA/raw_final_dataset/Samples/Virus_samples/VirusShare_4a6b41c239dd943b77b74737c670e610')
SECTION_VIRTUAL_SIZE_HEADER = ['.idata', '.rdata', '.data', '.rsrc', '.reloc']


def virtual_size_raw_size_ratio(pe):
    verdicts = {}
    present_verdicts = []
    for section in pe.sections:
        sectionname = ''.join(filter(lambda c: c != '\0', str(section.Name.decode('utf-8'))))
        raw_size = section.SizeOfRawData
        virtual_size = section.Misc_VirtualSize
        if 0.5 * virtual_size > raw_size:
            verdict = "1"
        else:
            verdict = "0"
        verdicts.update({sectionname: verdict})

    for item in SECTION_VIRTUAL_SIZE_HEADER:
        for key, value in verdicts.items():
            if key == item:
                present_verdicts.append(value)
        if item not in verdicts:
            present_verdicts.append(None)
        else:
            continue

    print(present_verdicts)


virtual_size_raw_size_ratio(pe)